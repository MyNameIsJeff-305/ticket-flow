# Database Schema Design

![db-diagram]

https://dbdiagram.io/d/6883de4acca18e685cccd6d0

## API Documentation

### User Authentication/Authorization

### All endpoints that require authentication

All endpoints that require a current user to be logged in.

- Request: endpoints that require authentication
- Error Response: Require authentication

  - Status Code: 401
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Authentication required"
    }
    ```

### All endpoints that require proper authorization

All endpoints that require authentication and the current user does not have the
correct role(s) or permission(s).

- Request: endpoints that require proper authorization
- Error Response: Require proper authorization

  - Status Code: 403
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Forbidden"
    }
    ```

### Users

#### Get the Current User

Returns the details of the logged in user. If no logged in user, returns null.

- Require Authentication: `false`
- Request:

  - Method: GET
  - URL: `/api/session`
  - Body: none

- Successful Response:
  - Status Code: 200
  - Headers:
    `Content-Type: application/json`
  - Body:

```json
{
  "user": {
    "id": 1,
    "firstName": "John",
    "lastName": "Smith",
    "username": "johnsmith",
    "profilePicUrl": "https://images.ctfassets.net/h6goo9gw1hh6/2sNZtFAWOdP1lmQ33VwRN3/24e953b920a9cd0ff2e1d587742a2472/1-intro-photo-final.jpg"
  }
}
```

- Successful Response when there is no logged in user
  - Status Code: 200
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "user": null
}
```

#### Log in

Logs in a user with valid credentials and returns the current user's information.

- Require Authentication: `false`
- Request
  - Method: POST
  - URL: `/api/session`
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "credential": "john.smith@gmail.com",
  "password": "password"
}
```

- Successful Response
  - Status Code: 200
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "user": {
    "id": 1,
    "email": "demo@aa.io",
    "username": "DemoEmp1",
    "firstName": "Demo",
    "lastName": "User",
    "profilePicUrl": "https://images.ctfassets.net/h6goo9gw1hh6/2sNZtFAWOdP1lmQ33VwRN3/24e953b920a9cd0ff2e1d587742a2472/1-intro-photo-final.jpg"
  }
}
```

- Error Response: Invalid Credentials
  - Status Code: 401
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "Invalid Credentials"
}
```

- Error Response: Body Validation Errors
  - Status Code: 400
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "Bad Request", //Or Validation Error if generated by Sequelize
  "errors": {
    "credential": "Email or username is required",
    "password": "Password is required"
  }
}
```

#### Sign Up a User

Creates a new user, logs them in as the current user, and returns the current user's information.

- Require Authentication: false
- Request
  - Method: POST
  - URL: `/api/users`
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "email": "newuser@gmail.com",
  "password": "password",
  "username": "newuser33",
  "firstName": "New",
  "lastName": "User",
  "title": "Designer",
  "departmentId": 1
}
```

- Successful Response
  - Status Code: 200
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "user": {
    "id": 7,
    "email": "newuser@gmail.com",
    "username": "newuser33",
    "firstName": "New",
    "lastName": "User"
  }
}
```

- Error Response: User already exists with the specified email
  - Status Code: 500
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "User already exists",
  "errors": {
    "email": "User with this email already exists"
  }
}
```

- Error Response: User already exists with the specified username
  - Status Code: 500
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "User already exists",
  "errors": {
    "username": "User with this username already exists"
  }
}
```

- Error Response: Body Validation Errors
  - Status Code: 400
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "Bad Request", //Or Validation Error if generated by Sequelize
  "errors": {
    "email": "Invalid email",
    "username": "Username is Required",
    "firstName": "First Name is required",
    "lastName": "Last Name is required"
  }
}
```

### Tickets

#### Get All Tickets

Returns all the Tickets.

- Require Authentication: true
- Request
  - Method: GET
  - URL: `/api/tickets`
  - Body: none
- Successful Response
  - Status Code: 200
  - Headers: `Content-Type: application/json`
  - Body:

```json
[
  {
    "id": 1,
    "title": "Network Connectivity Issues",
    "createdBy": {
      "id": 1,
      "firstName": "Demo",
      "lastName": "User",
      "profilePicUrl": "https://images.ctfassets.net/h6goo9gw1hh6/2sNZtFAWOdP1lmQ33VwRN3/24e953b920a9cd0ff2e1d587742a2472/1-intro-photo-final.jpg",
      "title": "Software Engineer",
      "username": "DemoEmp1",
      "departmentId": 1
    },
    "clientId": {
      "id": 1,
      "firstName": "Jane",
      "lastName": "Smith",
      "companyName": "",
      "email": "janesmith@techsolutions.com",
      "phoneNumber": null,
      "profilePicUrl": "https://spor12.dk/wp-content/uploads/2017/05/speaker-1.jpg",
      "createdAt": "2025-08-26T14:16:29.140Z",
      "updatedAt": "2025-08-26T14:16:29.140Z"
    },
    "description": "The office network is not working, can't connect to the internet.",
    "checkIn": null,
    "checkOut": null,
    "statusId": 1,
    "hashedId": "0XxR/v.CGH",
    "createdAt": "2025-08-26T14:16:29.146Z",
    "updatedAt": "2025-08-26T14:16:29.146Z"
  },
  {
    "id": 2,
    "title": "Slow Computer Performance",
    "createdBy": {
      "id": 2,
      "firstName": "Jane",
      "lastName": "Doe",
      "profilePicUrl": "https://www.elitesingles.com/wp-content/uploads/sites/85/2020/06/elite_singles_slide_6-350x264.png",
      "title": "Product Manager",
      "username": "DemoEmp2",
      "departmentId": 1
    },
    "clientId": {
      "id": 2,
      "firstName": "",
      "lastName": "",
      "companyName": "IT Innovators",
      "email": "mjohnson@itinnovators.io",
      "phoneNumber": null,
      "profilePicUrl": "https://governmenttechnologyinsider.com/wp-content/uploads/2018/09/shutterstock_691380820.jpg",
      "createdAt": "2025-08-26T14:16:29.140Z",
      "updatedAt": "2025-08-26T14:16:29.140Z"
    },
    "description": "My computer is very slow, it takes a long time to load applications.",
    "checkIn": null,
    "checkOut": null,
    "statusId": 1,
    "hashedId": "BSU8IfQPUe",
    "createdAt": "2025-08-26T14:16:29.146Z",
    "updatedAt": "2025-08-26T14:16:29.146Z"
  }
]
```
