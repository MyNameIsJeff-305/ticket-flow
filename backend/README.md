# Database Schema Design

![db-diagram]

https://dbdiagram.io/d/6883de4acca18e685cccd6d0

## API Documentation

### User Authentication/Authorization

### All endpoints that require authentication

All endpoints that require a current user to be logged in.

- Request: endpoints that require authentication
- Error Response: Require authentication

  - Status Code: 401
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Authentication required"
    }
    ```

### All endpoints that require proper authorization

All endpoints that require authentication and the current user does not have the
correct role(s) or permission(s).

- Request: endpoints that require proper authorization
- Error Response: Require proper authorization

  - Status Code: 403
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Forbidden"
    }
    ```

### Users

#### Get the Current User

Returns the details of the logged in user. If no logged in user, returns null.

- Require Authentication: `false`
- Request:

  - Method: GET
  - URL: `/api/session`
  - Body: none

- Successful Response:
  - Status Code: 200
  - Headers:
    `Content-Type: application/json`
  - Body:

```json
{
  "user": {
    "id": 1,
    "firstName": "John",
    "lastName": "Smith",
    "username": "johnsmith",
    "profilePicUrl": "https://images.ctfassets.net/h6goo9gw1hh6/2sNZtFAWOdP1lmQ33VwRN3/24e953b920a9cd0ff2e1d587742a2472/1-intro-photo-final.jpg"
  }
}
```

- Successful Response when there is no logged in user
  - Status Code: 200
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "user": null
}
```

#### Log in

Logs in a user with valid credentials and returns the current user's information.

- Require Authentication: `false`
- Request
  - Method: POST
  - URL: `/api/session`
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "credential": "john.smith@gmail.com",
  "password": "password"
}
```

- Successful Response
  - Status Code: 200
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "user": {
    "id": 1,
    "email": "demo@aa.io",
    "username": "DemoEmp1",
    "firstName": "Demo",
    "lastName": "User",
    "profilePicUrl": "https://images.ctfassets.net/h6goo9gw1hh6/2sNZtFAWOdP1lmQ33VwRN3/24e953b920a9cd0ff2e1d587742a2472/1-intro-photo-final.jpg"
  }
}
```

- Error Response: Invalid Credentials
  - Status Code: 401
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "Invalid Credentials"
}
```

- Error Response: Body Validation Errors
  - Status Code: 400
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "Bad Request", //Or Validation Error if generated by Sequelize
  "errors": {
    "credential": "Email or username is required",
    "password": "Password is required"
  }
}
```

#### Sign Up a User

Creates a new user, logs them in as the current user, and returns the current user's information.

- Require Authentication: `false`
- Request
  - Method: POST
  - URL: `/api/users`
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "email": "newuser@gmail.com",
  "password": "password",
  "username": "newuser33",
  "firstName": "New",
  "lastName": "User",
  "title": "Designer",
  "departmentId": 1
}
```

- Successful Response
  - Status Code: 200
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "user": {
    "id": 7,
    "email": "newuser@gmail.com",
    "username": "newuser33",
    "firstName": "New",
    "lastName": "User"
  }
}
```

- Error Response: User already exists with the specified email
  - Status Code: 500
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "User already exists",
  "errors": {
    "email": "User with this email already exists"
  }
}
```

- Error Response: User already exists with the specified username
  - Status Code: 500
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "User already exists",
  "errors": {
    "username": "User with this username already exists"
  }
}
```

- Error Response: Body Validation Errors
  - Status Code: 400
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "Bad Request", //Or Validation Error if generated by Sequelize
  "errors": {
    "email": "Invalid email",
    "username": "Username is Required",
    "firstName": "First Name is required",
    "lastName": "Last Name is required"
  }
}
```

### Tickets

#### Get All Tickets

Returns all the Tickets.

- Require Authentication: `true`
- Request
  - Method: GET
  - URL: `/api/tickets`
  - Body: none
- Successful Response
  - Status Code: 200
  - Headers: `Content-Type: application/json`
  - Body:

```json
[
  {
    "id": 1,
    "title": "Network Connectivity Issues",
    "createdBy": {
      "id": 1,
      "firstName": "Demo",
      "lastName": "User",
      "profilePicUrl": "https://images.ctfassets.net/h6goo9gw1hh6/2sNZtFAWOdP1lmQ33VwRN3/24e953b920a9cd0ff2e1d587742a2472/1-intro-photo-final.jpg",
      "title": "Software Engineer",
      "username": "DemoEmp1",
      "departmentId": 1
    },
    "clientId": {
      "id": 1,
      "firstName": "Jane",
      "lastName": "Smith",
      "companyName": "",
      "email": "janesmith@techsolutions.com",
      "phoneNumber": null,
      "profilePicUrl": "https://spor12.dk/wp-content/uploads/2017/05/speaker-1.jpg",
      "createdAt": "2025-08-26T14:16:29.140Z",
      "updatedAt": "2025-08-26T14:16:29.140Z"
    },
    "description": "The office network is not working, can't connect to the internet.",
    "checkIn": null,
    "checkOut": null,
    "statusId": 1,
    "hashedId": "0XxR/v.CGH",
    "createdAt": "2025-08-26T14:16:29.146Z",
    "updatedAt": "2025-08-26T14:16:29.146Z"
  },
  {
    "id": 2,
    "title": "Slow Computer Performance",
    "createdBy": {
      "id": 2,
      "firstName": "Jane",
      "lastName": "Doe",
      "profilePicUrl": "https://www.elitesingles.com/wp-content/uploads/sites/85/2020/06/elite_singles_slide_6-350x264.png",
      "title": "Product Manager",
      "username": "DemoEmp2",
      "departmentId": 1
    },
    "clientId": {
      "id": 2,
      "firstName": "",
      "lastName": "",
      "companyName": "IT Innovators",
      "email": "mjohnson@itinnovators.io",
      "phoneNumber": null,
      "profilePicUrl": "https://governmenttechnologyinsider.com/wp-content/uploads/2018/09/shutterstock_691380820.jpg",
      "createdAt": "2025-08-26T14:16:29.140Z",
      "updatedAt": "2025-08-26T14:16:29.140Z"
    },
    "description": "My computer is very slow, it takes a long time to load applications.",
    "checkIn": null,
    "checkOut": null,
    "statusId": 1,
    "hashedId": "BSU8IfQPUe",
    "createdAt": "2025-08-26T14:16:29.146Z",
    "updatedAt": "2025-08-26T14:16:29.146Z"
  }
]
```

#### Get All Tickets Assigned to the Current User

Returns all the Tickets assigned to the Current User

- Require Authentication: `true`
- Request
  - Method: GET
  - URL: `/api/tickets/current`
  - Body: none
- Successful Response
  - Status Code: 200
  - Headers: `Content-Type: application/json`
  - Body:

```json
[
  {
    "id": 1,
    "title": "Network Connectivity Issues",
    "createdBy": 1,
    "clientId": {
      "id": 1,
      "firstName": "Jane",
      "lastName": "Smith",
      "companyName": "",
      "email": "janesmith@techsolutions.com",
      "phoneNumber": null,
      "profilePicUrl": "https://spor12.dk/wp-content/uploads/2017/05/speaker-1.jpg",
      "createdAt": "2025-08-26T14:16:29.140Z",
      "updatedAt": "2025-08-26T14:16:29.140Z"
    },
    "description": "The office network is not working, can't connect to the internet.",
    "checkIn": null,
    "checkOut": null,
    "statusId": 1,
    "hashedId": "0XxR/v.CGH",
    "createdAt": "2025-08-26T14:16:29.146Z",
    "updatedAt": "2025-08-26T14:16:29.146Z"
  }
]
```

#### Get Details of a Ticket from an Id

Returns the details of a Ticket specified by its id.

- Require authentication: `true`
- Request
  - Method: GET
  - URL: `/api/tickets/:ticketId`
  - Body: none
- Successful Response
  - Status Code: 200
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "id": 1,
  "title": "Network Connectivity Issues",
  "description": "The office network is not working, can't connect to the internet.",
  "checkIn": null,
  "checkOut": null,
  "hashedId": "0XxR/v.CGH",
  "CreatedBy": {
    "id": 1,
    "firstName": "Demo",
    "lastName": "User",
    "profilePicUrl": "https://images.ctfassets.net/h6goo9gw1hh6/2sNZtFAWOdP1lmQ33VwRN3/24e953b920a9cd0ff2e1d587742a2472/1-intro-photo-final.jpg",
    "title": "Software Engineer",
    "username": "DemoEmp1",
    "departmentId": 1
  },
  "ClientInfo": {
    "id": 1,
    "firstName": "Jane",
    "lastName": "Smith",
    "companyName": "",
    "email": "janesmith@techsolutions.com",
    "phoneNumber": null,
    "profilePicUrl": "https://spor12.dk/wp-content/uploads/2017/05/speaker-1.jpg",
    "createdAt": "2025-08-26T14:16:29.140Z",
    "updatedAt": "2025-08-26T14:16:29.140Z"
  },
  "Parts": [
    {
      "id": 1,
      "name": "Ethernet Cable",
      "description": "Cat6 Ethernet cable for network connectivity",
      "ticketId": 1,
      "imageUrl": "https://media.startech.com/cms/products/gallery_large/n6patcxmbl.main.jpg",
      "createdAt": "2025-08-26T14:16:29.151Z",
      "updatedAt": "2025-08-26T14:16:29.151Z"
    },
    {
      "id": 2,
      "name": "Network Switch",
      "description": "5-port Gigabit Network Switch for office network",
      "ticketId": 1,
      "imageUrl": "https://intellinetsolutions.com/cdn/shop/products/24-port-gigabit-ethernet-switch-561273-1_11790351-cb3d-41e5-b877-6424af02441c.jpg",
      "createdAt": "2025-08-26T14:16:29.151Z",
      "updatedAt": "2025-08-26T14:16:29.151Z"
    },
    {
      "id": 21,
      "name": "Backup Power Supply",
      "description": "Uninterruptible Power Supply (UPS) for network devices",
      "ticketId": 1,
      "imageUrl": "https://i5.walmartimages.com.mx/mg/gm/3pp/asr/ebf7d5d3-9b04-4885-9eb3-160a4681e5d2.471379173e77c206d2cea3d05e307309.jpeg",
      "createdAt": "2025-08-26T14:16:29.151Z",
      "updatedAt": "2025-08-26T14:16:29.151Z"
    }
  ],
  "StatusInfo": {
    "id": 1,
    "name": "Open",
    "color": "#FF6B6B",
    "description": "The ticket is open and has not been assigned to anyone",
    "createdAt": "2025-08-26T14:16:29.136Z",
    "updatedAt": "2025-08-26T14:16:29.136Z"
  }
}
```

- Error Response: No Ticket Found
  - Status Code: 404
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "Ticket not found"
}
```

#### Create a Ticket

Creates and return a new Ticket

- Require Authentication: `true`
  - Method: POST
  - URL: `/api/tickets`
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "title": "My printer doesn't work",
  "description": "I am having a problem with my computer, it seems not be recognizing the printer, please I need your help",
  "clientId": 1
}
```

- Successful Response
  - Status Code: 201
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "id": 11,
  "title": "My printer doesn't work",
  "description": "I am having a problem with my computer, it seems not be recognizing the printer, please I need your help",
  "checkIn": null,
  "checkOut": null,
  "clientId": 1,
  "statusId": 1,
  "hashedId": "s_fwq!Xq!D",
  "createdBy": 1,
  "updatedAt": "2025-08-26T18:02:20.795Z",
  "createdAt": "2025-08-26T18:02:20.795Z"
}
```

- Error Response
  - Status Code: 400
  - Headers: `Content-Type: application/json`
  - Body:

```json
{
  "message": "Bad Request",
  "errors": {
    "title": "Title is required",
    "clientId": "Client Id is required"
  }
}
```
