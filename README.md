# Ticket Flow

TicketFlow is an intuitive and powerful ticket management system designed specifically for IT businesses. With streamlined workflows, real-time tracking, and comprehensive reporting features, TicketFlow ensures that IT support teams can efficiently manage tasks, resolve issues faster, and provide exceptional service. From ticket creation to resolution, TicketFlow keeps your IT operations organized, helping you stay on top of all support requests and improve customer satisfaction.

## Database Schema Design

![db-diagram]

[db-diagram]: ./images/db_diagram.png

## API Documentation

### User Authentication/Authorization

### All endpoints that require authentication

All endpoints that require a current user to be logged in.

- Request: endpoints that require authentication
- Error Response: Require authentication

  - Status Code: 401
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Authentication required"
    }
    ```

### All endpoints that require proper authorization

All endpoints that require authentication and the current user does not have the
correct role(s) or permission(s).

- Request: endpoints that require proper authorization
- Error Response: Require proper authorization

  - Status Code: 403
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Forbidden"
    }
    ```

### Get the Current User

Returns the information about the current user that is logged in.

- Require Authentication: true
- Request

  - Method: GET
  - URL: `/api/session`
  - Body: none

- Successful Response when there is a logged in user

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "user": {
        "id": 1,
        "firstName": "John",
        "lastName": "Smith",
        "email": "john.smith@gmail.com",
        "username": "JohnSmith"
      }
    }
    ```

- Successful Response when there is no logged in user

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "user": null
    }
    ```

### Log In a User

Logs in a current user with valid credentials and returns the current user's
information.

- Require Authentication: false
- Request

  - Method: POST
  - URL: `/api/session`
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "credential": "john.smith@gmail.com",
      "password": "secret password"
    }
    ```

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "user": {
        "id": 1,
        "firstName": "John",
        "lastName": "Smith",
        "email": "john.smith@gmail.com",
        "username": "JohnSmith"
      }
    }
    ```

- Error Response: Invalid credentials

  - Status Code: 401
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Invalid credentials"
    }
    ```

- Error response: Body validation errors

  - Status Code: 400
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Bad Request", // (or "Validation error" if generated by Sequelize),
      "errors": {
        "credential": "Email or username is required",
        "password": "Password is required"
      }
    }
    ```

### Sign Up a User

Creates a new user, logs them in as the current user, and returns the current
user's information.

- Require Authentication: false
- Request

  - Method: POST
  - URL: `/api/users`
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "firstName": "John",
      "lastName": "Smith",
      "companyName": "Company Name",
      "email": "john.smith@gmail.com",
      "username": "JohnSmith",
      "password": "secret password",
      "role": "employee"
    }
    ```

- Successful Response

  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "user": {
        "id": 1,
        "firstName": "John",
        "lastName": "Smith",
        "companyName": "Company Name",
        "email": "john.smith@gmail.com",
        "username": "JohnSmith",
        "role": "employee"
      }
    }
    ```

- Error response: User already exists with the specified email

  - Status Code: 500
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "User already exists",
      "errors": {
        "email": "User with that email already exists"
      }
    }
    ```

- Error response: User already exists with the specified username

  - Status Code: 500
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "User already exists",
      "errors": {
        "username": "User with that username already exists"
      }
    }
    ```

- Error response: Body validation errors

  - Status Code: 400
  - Headers:
    - Content-Type: application/json
  - Body:

    ```json
    {
      "message": "Bad Request", // (or "Validation error" if generated by Sequelize),
      "errors": {
        "email": "Invalid email",
        "username": "Username is required",
        "firstName": "First Name is required",
        "lastName": "Last Name is required",
        "companyName": "Company Name is required"
      }
    }
    ```

## Tickets

### Get All Tickets

Returns all the Tickets.

- Require Authentication: true
- Request

  - Method: GET
  - URL: `/api/tickets`
  - Body: none

- Successful Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
  ```json
  {
    "Tickets": [
      {
        "id": 1,
        "createdBy": 1,
        "takenBy": null,
        "title": "My printer doesn't work",
        "description": "I am having a problem with my computer, it seems not be recognizing the printer, please I need your help",
        "checkIn": null,
        "checkOut": null,
        "statusId": 1
      }
    ]
  }
  ```

### Get All Tickets Taken By the Current User

Returns all the Tickets taken by the Current User.

- Require Authentication: true

- Request

  - Method: GET
  - URL: `/api/tickets/current`
  - Body: none

- Successful Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
  ```json
  {
    "Tickets": [
      {
        "id": 1,
        "createdBy": 1,
        "takenBy": null,
        "title": "My printer doesn't work",
        "description": "I am having a problem with my computer, it seems not be recognizing the printer, please I need your help",
        "checkIn": null,
        "checkOut": null,
        "statusId": 1
      }
    ]
  }
  ```

### Get Details of a Ticket from an Id

Returns the details of a Ticket specified by its id.

- Require Authentication: true

- Request

  - Method: GET
  - URL: `/api/tickets/:ticketId`
  - Body: none

- Successful Response
  - Status Code: 200
  - Headers:
    - Content-Type: application/json
  - Body:
  ```json
  {
    "id": 1,
    "title": "My printer doesn't work",
    "description": "I am having a problem with my computer, it seems not be recognizing the printer, please I need your help",
    "checkIn": null,
    "checkOut": null,
    "status": "Created",
    "CreatedBy": {
      "id": 1,
      "firstName": "Demo",
      "lastName": "User"
    },
    "TakenBy": {
      "id": 4,
      "firstName": "Janet",
      "lastName": "Doe"
    },
    "Parts": [
      {
        "id": 1,
        "name": "Hard Drive",
        "description": "512 Gb SSD Hard Drive",
        "imageUrl": "https://www.westerndigital.com/content/dam/store/en-us/assets/products/internal-storage/wd-blue-desktop-sata-hdd/gallery/wd-blue-pc-desktop-hard-drive-500gb.png.thumb.1280.1280.png"
      },
      {
        "id": 2,
        "name": "Keyboard",
        "description": "Logitech wireless Keyboard",
        "imageUrl": "https://www.bhphotovideo.com/images/images500x500/logitech_920_010547_mx_mechanical_wireless_keyboard_1653360638_1703337.jpg"
      }
    ]
  }
  ```

### Create a Ticket

Creates and returns a new Ticket.

- Require Authentication: true
- Request:

  - Method: POST
  - URL: `/api/tickets`
  - Headers:
    - Content-Type: application/json
  - Body:

  ```json
  {
    "title": "My printer doesn't work",
    "description": "I am having a problem with my computer, it seems not be recognizing the printer, please I need your help"
  }
  ```

- Successful Response:

  - Status Code: 201
  - Headers:
    - Content-Type: application/json
  - Body:

  ```json
  {
    "title": "My printer doesn't work",
    "description": "I am having a problem with my computer, it seems not be recognizing the printer, please I need your help",
    "status": "Created",
    "CreatedBy": {
      "id": 1,
      "firstName": "Demo",
      "lastName": "User"
    }
  }
  ```

- Error Response: Body Validation Error
  - Status Code: 400
  - Headers:
    - Content-Type: application/json
  - Body:
  ```json
  {
    "message": "Bad Request",
    "errors": {
      "title": "Title is required"
    }
  }
  ```

### Add a Part to a Ticket based on the Ticket's Id

Create and return a new Part for a Spot specified by id.

- Require Authentication: true
- Require proper authorization: Ticket must belong to the current User
- Request
  - Method: POST
  - URL: `/api/tickets/:ticketId/parts`
  - Headers:
    - Content-Type: application/json
  - Body:
  ```json
  {
    "name": "Hard Drive",
    "description": "A 512 Gb SSD Drive",
    "imageUrl": "https://www.westerndigital.com/content/dam/store/en-us/assets/products/internal-storage/wd-blue-desktop-sata-hdd/gallery/wd-blue-pc-desktop-hard-drive-500gb.png.thumb.1280.1280.png"
  }
  ```

### Edit a Ticket

Updates and returns an existing ticket.

- Require Authentication: true
- Require Proper Authorization: TIcket must belong to the current user
- Request
  - Method: PUT
  - URL: `/api/tickets/:ticketId`
  - Headers:
    - Content-Type: application/json
  - Body:
  ```json
  {
    "title": "My printer doesn't work",
    "description": "I am having a problem with my computer, it seems not be recognizing the printer, please I need your help",
    "status": "Created",
    "createdBy": 1,
    "checkIn": "2024-04-01",
    "checkOut": "2024-05-03",
    "status": "completed"
  }
  ```
- Successful Response
  - Status Code: 200
  - Headers
    - Content-Type: application/json
  - Body:
  ```json
  {
    "title": "My printer doesn't work",
    "description": "I am having a problem with my computer, it seems not be recognizing the printer, please I need your help",
    "status": "Created",
    "createdBy": 1,
    "checkIn": "2024-04-01",
    "checkOut": "2024-05-03",
    "status": "completed"
  }
  ```
- Error Response: Body Validation Error
  - Status Code: 400
  - Headers:
    - Content-Type: application/json
  - Body:
  ```json
  {
    "title": "My printer doesn't work",
    "description": "I am having a problem with my computer, it seems not be recognizing the printer, please I need your help",
    "status": "Created",
    "createdBy": 1,
    "checkIn": "2024-04-01",
    "checkOut": "2024-05-03",
    "status": "completed"
  }
  ```
- Error Response: Couldn't find a Ticket based on the specified id
    - Status Code: 404
    - Headers:
        - Content-Type: application/json
    - Body:
    ```json
    {
        "message": "Ticket couldn't be found
    }
    ```

### Delete a Ticket

Deletes an existing Ticket.

- Require Authentication: true
- Require proper Authorization: Ticket must belong to the current user
- Request
    - Method: DELETE
    - URL: `/api/tickets/:ticketId`
    - Body: none

- Successful Response
    - Status Code: 200
    - Headers:
        - Content-Type: application/json
    - Body:
    ```json
    {
        "message": "Successfully Deleted"
    }
    ```

- Error Response: Couldn't find a TIcket with the specified id
    - Status Code: 404
    - Headers:
        - Content-Type: application/json
    - Body:
    ```json
    {
        "message": "Ticket couldn't be found"
    }
    ```
